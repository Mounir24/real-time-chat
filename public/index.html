<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <title>RealTime Chat -- Rooms</title>
</head>

<body>
    <!--<div class="container">
        <span id="feedback"></span>
        <ul id="messages">
        </ul>
        <form action="" class="form-container">
            <input type="text" id="msg" placeholder="Enter message">
            <button type="submit">Send</button>
        </form>
    </div>-->
    <div id="mario-chat">
        <h2>MBN public Chat App</h2>
        <div id="chat-window">
            <div id="messages"></div>
            <span id="feedback"></span>
        </div>
        <form>
            <input id="user" type="text" placeholder="Enter Your Username" />
            <input id="msg" type="text" placeholder="Enter Your Message" />
            <button type="submit">Send</button>
        </form>
    </div>

    <!--Loads the Socket library-->
    <script src="/socket.io/socket.io.js"></script>
    <!--Loads jQuery-->
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        //Initialize Socket.io
        const socket = io();

        // On form submit , Send message to server
        $('form').submit(() => {
            socket.emit('chat', {
                user: $('#user').val(),
                message: $('#msg').val()
            });
            $('#msg').val('');
            $('#user').val('');
            //alert('message has been sent successfuly')
            return false;
        });

        // Broadcats message
        $('#msg').on('keydown', () => {
            socket.emit('typing', $('#user').val());
        })

        // When a message sent to server , append it to DOM
        socket.on('chat', (payload) => {
            $('#feedback').text('');
            $('#messages').append($('<p>').text(payload.user + ': ' + payload.message));
        })

        // Broadcast message to the sockets
        socket.on('typing', (payload) => {
            $('#feedback').text(payload + ' typing...');
        })
    </script>
</body>

</html>